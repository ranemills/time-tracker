{"version":3,"sources":["../src/scripts/app.js"],"names":["angular","module","run","activityService","recordService","init","$rootScope","$window","demoDataService","testService","testWrapper","fn","params","isTestMode","$apply","_","identity","enableTestMode","disableTestMode","addDemoData","addActivity","addRecord","service","testMode","settingsService","moment","clearData","demoActivities","each","activity","addDefinedActivity","startTime","endTime","currentTime","clone","isBefore","nextTime","add","random","duration","diff","sample","getDefinedActivities","note","storageService","clear","controller","mainCtrl","$onInit","showEdit","saveTime","recordPendingSave","recordTime","getSelectedActivity","discardActivity","getRecords","constant","window","STORAGE_DEFINED_ACTIVITIES","selectedActivity","definedActivities","getValue","setSelectedActivity","push","setValue","STORAGE_RECORDED_ACTIVITIES","records","data","key","localStorage","setItem","JSON","stringify","parse","getItem","component","templateUrl","bindings","controllerAs","activitySelectorCtrl","changeActivity","getActivities","newActivityName","getButtonStyle","timePieChartCtrl","labels","chartData","equals","cachedRecords","transform","result","record","get","size","keys","cachedData","values","$scope","timeChartCtrl","options","scales","yAxes","display","ticks","beginAtZero","onStop","isTiming","start","$broadcast","stop","$on","bind","event","onSave","onCancel","editActivityCtrl","activityTypes","settingsCtrl","location","reload"],"mappings":"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","file":"app.js","sourcesContent":["angular.module('timeTrackerApp', ['angularMoment', 'timer', 'chart.js'])\n.run(function(activityService, recordService) {\n  activityService.init();\n  recordService.init();\n})\n// This run-block defines test-only functionality\n.run(function($rootScope, $window, demoDataService, testService, recordService) {\n  function testWrapper(fn) {\n    return function(params) {\n      if(testService.isTestMode()) {\n        fn(params);\n        $rootScope.$apply();\n      }\n      else {\n        _.identity();\n      }\n    }\n  }\n\n  $window.enableTestMode = testService.enableTestMode;\n  $window.disableTestMode = testService.disableTestMode;\n  $window.addDemoData = testWrapper(demoDataService.addDemoData);\n  $window.addActivity = testWrapper(recordService.addRecord);\n})\n.service('testService', function () {\n\n  let testMode = false;\n\n  function enableTestMode() {\n    testMode = true;\n  }\n\n  function disableTestMode() {\n    testMode = false;\n  }\n\n  function isTestMode() {\n    return testMode;\n  }\n\n  return {\n    enableTestMode,\n    disableTestMode,\n    isTestMode\n  }\n\n})\n.service('demoDataService', function(activityService, recordService, settingsService, moment, _, $window) {\n\n  function addDemoData() {\n    settingsService.clearData();\n\n    let demoActivities = ['Coding', 'Meeting', 'Talking', 'Emails'];\n\n    _.each(demoActivities, (activity) => activityService.addDefinedActivity(activity));\n\n    let startTime = moment('2017-05-01 09:00:00');\n    let endTime = moment('2017-05-01 17:30:00');\n\n    let currentTime = _.clone(startTime);\n\n    while(currentTime.isBefore(endTime))\n    {\n      let nextTime = currentTime.clone().add(_.random(5,90), 'm');\n      recordService.addRecord({\n        startTime: currentTime,\n        endTime: nextTime,\n        duration: nextTime.diff(currentTime),\n        activity: _.sample(activityService.getDefinedActivities()),\n        note: ''\n      });\n      currentTime = nextTime;\n    }\n  }\n\n  return {\n    addDemoData\n  }\n\n})\n.service('settingsService', function(activityService, storageService, recordService) {\n  function clearData() {\n    storageService.clear();\n    activityService.init();\n    recordService.init();\n  }\n\n  return {\n    clearData\n  }\n})\n.controller('mainCtrl', function (recordService, activityService) {\n  let mainCtrl = this;\n\n  mainCtrl.$onInit = function() {\n    mainCtrl.showEdit = false;\n  };\n\n  mainCtrl.saveTime = function() {\n    recordService.addRecord(mainCtrl.recordPendingSave);\n    mainCtrl.showEdit = false;\n    mainCtrl.recordPendingSave = null;\n  };\n\n  mainCtrl.recordTime = function(startTime, endTime) {\n    mainCtrl.showEdit = true;\n    mainCtrl.recordPendingSave = {\n      startTime,\n      endTime,\n      duration: endTime.diff(startTime),\n      activity: activityService.getSelectedActivity(),\n      note: ''\n    }\n  };\n\n  mainCtrl.discardActivity = function() {\n    mainCtrl.showEdit = false;\n    mainCtrl.recordPendingSave = null;\n  };\n\n  mainCtrl.getRecords = recordService.getRecords;\n\n})\n.constant('_', window._)\n.service('activityService', function(storageService) {\n  const STORAGE_DEFINED_ACTIVITIES = \"DEFINED_ACTIVITIES\";\n\n  let selectedActivity = '';\n  let definedActivities = [];\n\n  function init() {\n    definedActivities = storageService.getValue(STORAGE_DEFINED_ACTIVITIES) || ['Default'];\n  }\n\n  function getSelectedActivity() {\n    return selectedActivity;\n  }\n\n  function setSelectedActivity(activity) {\n    selectedActivity = activity;\n  }\n\n  function getDefinedActivities() {\n    return definedActivities;\n  }\n\n  function addDefinedActivity(activity) {\n    definedActivities.push(activity);\n    storageService.setValue(STORAGE_DEFINED_ACTIVITIES, definedActivities);\n  }\n\n  return {\n    init,\n    getSelectedActivity,\n    setSelectedActivity,\n    getDefinedActivities,\n    addDefinedActivity\n  }\n})\n.service('recordService', function(storageService) {\n  const STORAGE_RECORDED_ACTIVITIES = \"RECORDED_ACTIVITIES\";\n\n  // Record format: { startDate, endDate, duration, activity }\n\n  let records = [];\n\n  function init() {\n    records = storageService.getValue(STORAGE_RECORDED_ACTIVITIES) || [];\n  }\n\n  function getRecords() {\n    return records;\n  }\n\n  function addRecord(data) {\n    records.push(data);\n    storageService.setValue(STORAGE_RECORDED_ACTIVITIES, records);\n  }\n\n  return {\n    init,\n    getRecords,\n    addRecord\n  }\n})\n.service('storageService', function(_, $window) {\n\n  function setValue(key, data) {\n    $window.localStorage.setItem(key, JSON.stringify(data));\n  }\n\n  function getValue(key) {\n    return JSON.parse($window.localStorage.getItem(key));\n  }\n\n  function clear() {\n    $window.localStorage.clear();\n  }\n\n  return {\n    setValue,\n    getValue,\n    clear\n  }\n\n})\n.component('charts', {\n  templateUrl: 'components/charts.html',\n  bindings: {\n    records: '<'\n  },\n  controllerAs: 'chartsCtrl',\n  controller: function() {\n\n  }\n})\n.component('activitySelector', {\n  templateUrl: 'components/activity-selector.html',\n  bindings: {},\n  controllerAs: 'activitySelectorCtrl',\n  controller: function(activityService) {\n    let activitySelectorCtrl = this;\n\n    activitySelectorCtrl.$onInit = function() {\n      activitySelectorCtrl.changeActivity(activitySelectorCtrl.getActivities()[0]);\n      activitySelectorCtrl.newActivityName = '';\n    };\n\n    activitySelectorCtrl.getActivities = activityService.getDefinedActivities;\n\n    activitySelectorCtrl.getButtonStyle  = function(activity) {\n      return activity === activityService.getSelectedActivity() ? 'active' : '';\n    };\n\n    activitySelectorCtrl.changeActivity = function(activity) {\n      activityService.setSelectedActivity(activity);\n    };\n\n    activitySelectorCtrl.addActivity = function() {\n      activityService.addDefinedActivity(activitySelectorCtrl.newActivityName);\n      activityService.setSelectedActivity(activitySelectorCtrl.newActivityName);\n      activitySelectorCtrl.newActivityName = '';\n    }\n  }\n})\n.component('timePieChart', {\n  templateUrl: 'components/time-pie-chart.html',\n  bindings: {\n    records: '<'\n  },\n  controllerAs: 'timePieChartCtrl',\n  controller: function() {\n    let timePieChartCtrl = this;\n\n    timePieChartCtrl.$onInit = function() {\n      timePieChartCtrl.labels = ['All'];\n    };\n\n    timePieChartCtrl.chartData = function() {\n      if(!angular.equals(timePieChartCtrl.records, timePieChartCtrl.cachedRecords))\n      {\n        timePieChartCtrl.cachedRecords = _.clone(timePieChartCtrl.records);\n\n        let data = _.transform(timePieChartCtrl.records, function(result, record) {\n          result[record.activity] = _.get(result, record.activity, 0) + record.duration/1000;\n        }, {});\n\n        if(_.size(data) !== 0) {\n          timePieChartCtrl.labels = _.keys(data);\n          timePieChartCtrl.cachedData =  _.values(data);\n        } else {\n          timePieChartCtrl.labels = ['N/A'];\n          timePieChartCtrl.cachedData = [0];\n        }\n      }\n      return timePieChartCtrl.cachedData;\n    }\n  }\n})\n.component('timeChart', {\n  templateUrl: 'components/time-chart.html',\n  bindings: {\n    records: '<'\n  },\n  controllerAs: 'timeChartCtrl',\n  controller: function($scope, _) {\n    let timeChartCtrl = this;\n\n    timeChartCtrl.$onInit = function() {\n      timeChartCtrl.labels = ['All'];\n      timeChartCtrl.options = {\n        scales: {\n          yAxes: [{\n            display: true,\n            ticks: {\n              beginAtZero: true\n            }\n          }]\n        }\n      }\n    };\n\n    timeChartCtrl.chartData = function() {\n      if(!angular.equals(timeChartCtrl.records, timeChartCtrl.cachedRecords))\n      {\n        timeChartCtrl.cachedRecords = _.clone(timeChartCtrl.records);\n\n        let data = _.transform(timeChartCtrl.records, function(result, record) {\n          result[record.activity] = _.get(result, record.activity, 0) + record.duration/1000;\n        }, {});\n\n        if(_.size(data) !== 0) {\n          timeChartCtrl.labels = _.keys(data);\n          timeChartCtrl.cachedData =  _.values(data);\n        } else {\n          timeChartCtrl.labels = ['N/A'];\n          timeChartCtrl.cachedData = [0];\n        }\n      }\n      return timeChartCtrl.cachedData;\n    }\n  }\n})\n.component('recordTable', {\n  templateUrl: 'components/records-table.html',\n  bindings: {\n    records: '<'\n  },\n  controllerAs: 'recordTableCtrl',\n  controller: function() {\n    this.getRecords = () => this.records;\n  }\n})\n.component('timerComponent', {\n  templateUrl: 'components/timer.html',\n  bindings: {\n    onStop: '&'\n  },\n  controllerAs: 'timerCtrl',\n  controller: function ($scope, moment) {\n\n    this.$onInit = function() {\n      this.isTiming = false;\n      this.startTime = null;\n      this.endTime = null;\n    };\n\n    this.start = function () {\n      $scope.$broadcast('timer-start');\n      this.startTime = moment();\n      this.isTiming = true;\n    };\n\n    this.stop = function () {\n      $scope.$broadcast('timer-stop');\n    };\n\n    // Once we know that the timer has stopped, we can do stuff with it\n    $scope.$on('timer-stopped', angular.bind(this, function (event, data) {\n      this.endTime = moment();\n      this.isTiming = false;\n      this.onStop({startTime: this.startTime, endTime: this.endTime});\n    }));\n  }\n})\n.component('editActivityComponent', {\n  templateUrl: 'components/edit-activity.html',\n  bindings: {\n    activity: '<',\n    onSave: '&',\n    onCancel: '&'\n  },\n  controllerAs: 'editActivityCtrl',\n  controller: function (activityService) {\n    let editActivityCtrl = this;\n\n    editActivityCtrl.$onInit = function() {\n      editActivityCtrl.activityTypes = activityService.getDefinedActivities();\n    }\n  }\n})\n.component('settingsComponent', {\n  templateUrl: 'components/settings.html',\n  bindings: {},\n  controllerAs: 'settingsCtrl',\n  controller: function ($window, storageService) {\n    let settingsCtrl = this;\n\n    settingsCtrl.clear = function() {\n      storageService.clear();\n      $window.location.reload();\n    }\n  }\n});"]}